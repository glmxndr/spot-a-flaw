<h2><%=h @topic.title %></h2>


<% if @topic.origin.length > 0 -%>
<p class="topic origin">
  <em>
    <%=textilize @topic.origin %>
  </em>
</p>
<% end -%>

<% if @topic.url.length > 0 -%>
<p><b>Url:</b><%=h @topic.url %></p>
<% end -%>

<p>
  <%=textilize @topic.content %>
</p>


<% if enabled_user -%>
<hr/>
  <p>
  <% form_for [@topic,Comment.new], :action => "create" do |f| %>
    <%= f.label :title %>
    <%= f.text_field :title %><br/>
    <%= f.text_area :content, :size => "40x5" %>
    <input
       type="hidden"
       name="comment[user_id]"
       value="<%= current_user.id %>" />
    <input
       type="hidden"
       name="comment[topic_id]"
       value="<%= @topic.id%>" />
    <br/>
    <%= f.submit "Send" %>
  <% end -%>
  </p>
<% end -%>


<hr/>

<h2>List of flagged fallacies</h2>

<% for flag in @topic.flags %>
<%= render :partial => 'flag', :locals => { :flag => flag} %>
<% end %>

<% if enabled_user -%>

<p>Add a flag:
<% form_for [@topic,Flag.new] do |f| %>
    <input
       type="hidden"
       name="flag[user_id]"
       value="<%= current_user.id %>" />
    <input
       type="hidden"
       name="flag[topic_id]"
       value="<%= @topic.id%>" />
    <%= f.label :fallacy_id,"Fallacy" %>
    <%= select(
        "flag",
        "fallacy_id",
        Fallacy.all.collect {|p| [ p.shortname, p.id ] })
    %><br/>
    <%= f.text_area :content, :size => "40x10" %><br/>
    <%= f.submit "Send" %>

<% end %>
</p>

<% end -%>

<hr/>

<h2>List of comments on this topic</h2>

<% for comment in @topic.comments %>
<%= render :partial => 'comments/_show', :locals => { :comment => comment} %>
<% end %>


<%= link_to 'Edit', edit_topic_path(@topic) %> |
<%= link_to 'Back', topics_path %>
